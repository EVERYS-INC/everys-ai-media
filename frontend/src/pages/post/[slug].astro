---
import ArticleLayout from "../../layouts/ArticleLayout.astro";
import { marked } from 'marked';

// 静的ページ生成のためのパスを定義
export async function getStaticPaths() {
  const strapiUrl = import.meta.env.STRAPI_URL;
  const response = await fetch(`${strapiUrl}/api/posts?populate=*`);
  const { data } = await response.json();

  // 各記事に対してパラメータとプロップを生成
  return data.map((post) => ({
    params: { slug: post.attributes.slug },
    props: { post },
  }));
}

// 現在のページの記事データを取得
const { post } = Astro.props;

// サイドバー用の最新記事を取得
const strapiUrl = import.meta.env.STRAPI_URL;
const recentPostsResponse = await fetch(
  `${strapiUrl}/api/posts?sort[0]=createdAt:desc&pagination[limit]=5`
);
const { data: recentPosts } = await recentPostsResponse.json();

// マークダウンコンテンツをHTMLに変換
const content = marked(post.attributes.content);
---

<!-- ArticleLayoutを適用し、記事内容を表示 -->
<ArticleLayout title={post.attributes.title} recentPosts={recentPosts}>
  <article>
    <h1 class="text-3xl font-bold mb-4">{post.attributes.title}</h1>
    <div set:html={content} />
  </article>
</ArticleLayout>